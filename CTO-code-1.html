<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Код ядра</title>
    <style>
      :root {
        --pad: 20px;
        --accent: #00ff41;
        --bg: #050505;
        --console-bg: #0f0f0f;
        --muted: #555;
      }

      html,
      body {
        height: 100%;
      }

      body {
        background-color: var(--bg);
        color: var(--accent);
        font-family: "Courier New", Courier, monospace;
        margin: 0;
        padding: calc(var(--pad) + env(safe-area-inset-top))
          env(safe-area-inset-right)
          calc(var(--pad) + env(safe-area-inset-bottom))
          env(safe-area-inset-left);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
        text-shadow: 0 0 5px rgba(0, 255, 65, 0.2);
        -webkit-font-smoothing: antialiased;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      }

      /* Reduce text-shadow on narrow screens to improve legibility */
      @media (max-width: 420px) {
        body {
          text-shadow: none;
        }
      }

      body::before {
        content: " ";
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
            rgba(18, 16, 16, 0) 50%,
            rgba(0, 0, 0, 0.25) 50%
          ),
          linear-gradient(
            90deg,
            rgba(255, 0, 0, 0.06),
            rgba(0, 255, 0, 0.02),
            rgba(0, 0, 255, 0.06)
          );
        z-index: 2;
        background-size: 100% 2px, 3px 100%;
        pointer-events: none;
      }

      #app-container {
        width: calc(100% - 40px);
        max-width: 900px;
        z-index: 10;
        position: relative;
        margin: 0 auto;
      }

      .header-time {
        font-size: clamp(1.1rem, 4vw, 2em);
        font-weight: bold;
        text-align: center;
        margin-bottom: 10px;
        border-bottom: 2px solid #333;
        padding-bottom: 10px;
        color: var(--accent);
      }
      .console-box {
        background-color: var(--console-bg);
        border: 2px solid var(--accent);
        padding: clamp(12px, 3vw, 20px);
        margin-bottom: 20px;
        box-shadow: 0 0 15px rgba(0, 255, 65, 0.08);
        border-radius: 8px;
        /* Allow scrolling on small screens and smooth native scrolling on iOS */
        max-height: calc(100vh - 160px);
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      .output-display {
        margin-top: 8px;
        min-height: 28px;
        white-space: pre-wrap;
        color: #ccffcc;
        word-break: break-word;
        overflow-wrap: anywhere;
        max-height: 8vh;
        overflow: auto;
      }

      pre.comment {
        background: transparent;
        padding: 12px;
        border-radius: 6px;
        color: #aaffb3;
        font-family: inherit;
        font-size: clamp(0.8rem, 2.4vw, 0.95rem);
        border-left: 3px solid rgba(0, 255, 65, 0.12);
        white-space: pre-wrap;
        /* Give the puzzle text more vertical room by default */
        max-height: 40vh;
        min-height: 18vh;
        overflow: auto;
      }

      .field {
        margin-top: 14px;
      }
      label {
        display: block;
        margin-bottom: 6px;
        font-weight: 700;
        color: #bfffbf;
      }
      input[type="text"] {
        background-color: #000;
        border: 1px solid var(--accent);
        color: var(--accent);
        font-family: "Courier New", monospace;
        font-size: clamp(16px, 3.8vw, 18px);
        padding: clamp(10px, 3.5vw, 12px);
        outline: none;
        text-transform: uppercase;
        width: 100%;
        box-sizing: border-box;
        border-radius: 6px;
        min-height: 44px; /* touch-friendly */
        -webkit-appearance: none;
      }
      input.valid {
        background: rgba(34, 139, 34, 0.06);
        border-color: #28a745;
      }
      input.invalid {
        background: rgba(220, 53, 69, 0.04);
        border-color: #dc3545;
      }

      #resultMessage {
        margin-top: 14px;
        font-weight: 700;
        color: #00ff80;
        display: none;
      }

      .hint {
        color: #6b7280;
        font-size: 13px;
        margin-top: 6px;
        color: #9bbf9b;
      }

      .status-window {
        border: 1px solid var(--muted);
        padding: 10px;
        min-height: 80px;
        background-color: #0a0a0a;
        margin-top: 10px;
        max-height: 22vh;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
      }

      @media (max-width: 600px) {
        #app-container {
          width: calc(100% - 24px);
        }
        .console-box {
          padding: 12px;
          margin-bottom: 14px;
        }
        pre.comment {
          font-size: 0.9rem;
        }
      }

      /* Extra adjustments for very small phones */
      @media (max-width: 420px) {
        body {
          padding: calc(var(--pad) / 2 + env(safe-area-inset-top))
            env(safe-area-inset-right)
            calc(var(--pad) / 2 + env(safe-area-inset-bottom))
            env(safe-area-inset-left);
        }
        .header-time {
          font-size: 1.1rem;
        }
        .output-display {
          max-height: 10vh;
          font-size: 14px;
        }
        pre.comment {
          padding: 10px;
        }
        label {
          font-size: 14px;
        }
        .hint {
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <div id="app-container">
      <div class="header-time">System Logs</div>

      <div class="console-box">
        <label for="nameInput">КОД ЯДРА //</label>
        <div class="output-display" id="feedbackArea">
          &gt; ОЖИДАНИЕ ВВОДА...
        </div>

        <pre class="comment">
/*
 * AUTHOR: Senior_Dev_Vassily (Fired in 2020)
 * DATE: 15.11.2021
 * TICKET: JIRA-666 "Fix everything"
 * TODO: Refactor this mess before the AI takes over.
 *
 * Если ты это читаешь, значит, документации снова нет.
 * Пароль к ядру я зашифровал так, чтобы его понял только тот, кто болея ковидом,  познал дзен в серверной.
 
 * ЧАСТЬ 1 (Слово):
 - Coffee overdose (пульс 140)
 - Rollback (потому что прод упал)
 - Null Pointer Exception (твоя премия)
 - Out of memory (когда Chrome съел всю RAM)
 - Merge Conflict (вечер пятницы)
 - Invalid Argument (разговор с заказчиком)
 - One more fix (последний, честно)


* ЧАСТЬ 2 (ЧИСЛО):
 * (Not Found) + (Accepted) + (SSH Port - 2)
 */</pre
        >

        <div class="field">
          <label for="nameInput">ЧАСТЬ 1 (Слово): Введите слово</label>
          <input
            id="nameInput"
            type="text"
            placeholder="Введите ответ"
            autocomplete="off"
          />
          <div class="hint">
            Все буквы автоматически приводятся к верхнему регистру.
          </div>
        </div>

        <div class="field">
          <label for="numberInput">ЧАСТЬ 2 (ЧИСЛО): Введите код</label>
          <input
            id="numberInput"
            type="text"
            placeholder="введите число"
            autocomplete="off"
          />
          <div class="hint">Введите точную последовательность чисел</div>
        </div>

        <div id="resultMessage">Код ядра OMICRON-626</div>
      </div>

      <div class="status-window" id="statusLog"></div>
    </div>

    <script>
      const nameInput = document.getElementById("nameInput");
      const numberInput = document.getElementById("numberInput");
      const resultMessage = document.getElementById("resultMessage");
      const statusLog = document.getElementById("statusLog");
      let coreCodeAppended = false;

      function tryAppendCoreCode() {
        if (coreCodeAppended) return;
        if (
          nameInput.value === "OMICRON" &&
          numberInput.value.trim() === "626"
        ) {
          const el = document.createElement("div");
          el.textContent = "OMICRON-626";
          el.style.color = "#9bbf9b";
          el.style.fontWeight = "700";
          statusLog.appendChild(el);
          coreCodeAppended = true;
        }
      }

      // --- Typing sound using Web Audio API (no external files) ---
      let audioCtx = null;

      function ensureAudioContext() {
        if (!audioCtx) {
          audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
      }

      function playKeySound() {
        try {
          ensureAudioContext();
          const ctx = audioCtx;
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = "square";
          o.frequency.value = 1000 + Math.random() * 400;
          g.gain.value = 0.0015;
          o.connect(g);
          g.connect(ctx.destination);
          const now = ctx.currentTime;
          g.gain.cancelScheduledValues(now);
          g.gain.setValueAtTime(0.0015, now);
          g.gain.exponentialRampToValueAtTime(0.00001, now + 0.06);
          o.start(now);
          o.stop(now + 0.07);
        } catch (err) {
          // audio may be blocked or unavailable — silently ignore
        }
      }

      // Resume suspended AudioContext after first user gesture (mobile/Chrome policy)
      function resumeAudioOnUserGesture() {
        if (!audioCtx) return;
        if (audioCtx.state === "suspended") {
          audioCtx.resume().catch(() => {});
        }
        document.removeEventListener("touchstart", resumeAudioOnUserGesture);
        document.removeEventListener("click", resumeAudioOnUserGesture);
        document.removeEventListener("keydown", resumeAudioOnUserGesture);
      }
      document.addEventListener("click", resumeAudioOnUserGesture, {
        once: true,
      });
      document.addEventListener("touchstart", resumeAudioOnUserGesture, {
        once: true,
      });
      document.addEventListener("keydown", resumeAudioOnUserGesture, {
        once: true,
      });

      // Play sound for printable keys and common edit keys
      function shouldPlayForKey(e) {
        const k = e.key;
        return (
          k.length === 1 ||
          k === "Backspace" ||
          k === "Delete" ||
          k === "Enter" ||
          k === " "
        );
      }

      [nameInput, numberInput].forEach((el) => {
        el.addEventListener("keydown", (e) => {
          ensureAudioContext();
          if (shouldPlayForKey(e)) playKeySound();
        });
        // Also play on virtual keyboard input events if needed
        el.addEventListener("input", (e) => {
          // Keep original behavior (validation) below — but also attempt a sound
          // This covers some mobile keyboards that don't fire keydown for characters
          playKeySound();
        });
      });

      // --- Existing input validation logic ---
      nameInput.addEventListener("input", (e) => {
        const el = e.target;
        const start = el.selectionStart;
        el.value = el.value.toUpperCase();
        el.setSelectionRange(start, start);
        if (el.value === "OMICRON") {
          el.classList.add("valid");
          el.classList.remove("invalid");
          tryAppendCoreCode();
        } else if (el.value === "") {
          el.classList.remove("valid");
          el.classList.remove("invalid");
        } else {
          el.classList.add("invalid");
          el.classList.remove("valid");
        }
      });

      numberInput.addEventListener("input", (e) => {
        const el = e.target;
        const v = el.value.trim();
        if (v === "626") {
          el.classList.add("valid");
          el.classList.remove("invalid");
          resultMessage.style.display = "block";
          tryAppendCoreCode();
        } else if (v === "") {
          el.classList.remove("valid");
          el.classList.remove("invalid");
          resultMessage.style.display = "none";
        } else {
          el.classList.add("invalid");
          el.classList.remove("valid");
          resultMessage.style.display = "none";
        }
      });
    </script>
  </body>
</html>
