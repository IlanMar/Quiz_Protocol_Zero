<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple CAPTCHA Demo</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
      }

      .container {
        background: #ffffff;
        padding: 24px 28px;
        border-radius: 10px;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
        max-width: 340px;
        width: 100%;
        box-sizing: border-box;
      }

      h1 {
        font-size: 20px;
        margin: 0 0 16px;
        color: #111827;
      }

      p {
        margin: 0 0 16px;
        font-size: 14px;
        color: #4b5563;
      }

      .captcha-box {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 12px;
      }

      .captcha-text {
        flex: 1;
        padding: 10px 12px;
        border-radius: 8px;
        background: repeating-linear-gradient(
          -45deg,
          #e5e7eb,
          #e5e7eb 6px,
          #f9fafb 6px,
          #f9fafb 12px
        );
        font-family: "Courier New", monospace;
        font-size: 20px;
        letter-spacing: 4px;
        text-align: center;
        text-decoration: line-through;
        color: #111827;
        user-select: none;
      }

      .refresh-btn {
        border: none;
        background: #111827;
        color: #f9fafb;
        border-radius: 999px;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 18px;
      }

      .refresh-btn:hover {
        background: #000000;
      }

      .field {
        margin-bottom: 12px;
      }

      .field label {
        display: block;
        font-size: 13px;
        margin-bottom: 4px;
        color: #374151;
      }

      .field input {
        width: 100%;
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        font-size: 14px;
      }

      .field input:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 1px #2563eb33;
      }

      .submit-btn {
        width: 100%;
        padding: 9px 10px;
        border-radius: 8px;
        border: none;
        background: #2563eb;
        color: white;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
      }

      .submit-btn:hover {
        background: #1d4ed8;
      }

      .message {
        margin-top: 10px;
        font-size: 13px;
      }

      .message.ok {
        color: #15803d;
      }

      .message.error {
        color: #b91c1c;
      }

      .usb-stage {
        margin-top: 12px;
        display: none;
      }

      .usb-images {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
      }

      .usb-port,
      .usb-drive {
        flex: 1;
        border-radius: 8px;
        border: 2px solid #111827;
        background: #f9fafb;
        padding: 10px 8px;
        text-align: center;
        font-size: 11px;
        color: #111827;
      }

      .usb-port-diagram,
      .usb-drive-diagram {
        width: 100%;
        height: 36px;
        border-radius: 6px;
        border: 2px dashed #9ca3af;
        margin-bottom: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .usb-port-shell {
        width: 85%;
        height: 60%;
        border-radius: 4px;
        border: 2px solid #111827;
        background: #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .usb-port-slot {
        width: 80%;
        height: 45%;
        border-radius: 3px;
        background: #0f172a;
        display: flex;
        align-items: center;
        justify-content: space-evenly;
      }

      .usb-pin {
        width: 18%;
        height: 55%;
        border-radius: 2px;
        background: #facc15;
      }

      .usb-drive-body {
        width: 75%;
        height: 55%;
        border-radius: 4px;
        background: #4b5563;
        position: relative;
      }

      .usb-drive-head {
        position: absolute;
        left: 4px;
        top: 25%;
        width: 26%;
        height: 50%;
        border-radius: 2px;
        background: #e5e7eb;
      }

      .usb-buttons {
        display: flex;
        gap: 8px;
      }

      .usb-btn {
        flex: 1;
        padding: 8px 10px;
        border-radius: 8px;
        border: none;
        background: #111827;
        color: #f9fafb;
        font-size: 12px;
        cursor: pointer;
      }

      .usb-btn:hover:enabled {
        background: #000000;
      }

      .usb-btn:disabled {
        opacity: 0.6;
        cursor: default;
      }
      .usb-image {
        width: 100%;
        height: auto;
        border-radius: 8px;
        border: 2px solid #e5e7eb;
        background: #ffffff;
        display: block;
      }

      .usb-caption {
        margin-top: 8px;
        font-size: 13px;
        color: #374151;
        text-align: center;
      }

      /* BETA-600 overlay */
      .beta-overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(2, 6, 23, 0.85);
        z-index: 9999;
      }

      .beta-text {
        color: #fef3c7;
        font-size: 88px;
        font-weight: 900;
        letter-spacing: 8px;
        text-shadow: 0 6px 30px rgba(0, 0, 0, 0.6),
          0 1px 0 rgba(255, 255, 255, 0.05);
        transform: scale(0.9);
        transition: transform 400ms cubic-bezier(0.2, 0.9, 0.3, 1);
      }

      .beta-overlay.show .beta-text {
        transform: scale(1);
      }

      /* Mobile / small screens adjustments */
      @media (max-width: 480px) {
        .container {
          padding: 18px 16px;
          border-radius: 8px;
        }

        h1 {
          font-size: 18px;
        }

        p {
          font-size: 13px;
        }

        .captcha-box {
          flex-direction: column;
          align-items: stretch;
        }

        .captcha-text {
          font-size: 18px;
          letter-spacing: 2px;
          padding: 10px;
          text-decoration: none;
        }

        .refresh-btn {
          width: 36px;
          height: 36px;
          font-size: 16px;
          margin-top: 8px;
        }

        .field input {
          padding: 9px 10px;
          font-size: 15px;
        }

        .submit-btn {
          padding: 10px 12px;
          font-size: 15px;
        }

        .usb-images {
          flex-direction: column;
          gap: 10px;
        }

        .usb-port-diagram,
        .usb-drive-diagram {
          height: 42px;
        }

        .usb-btn {
          font-size: 13px;
          padding: 10px;
        }

        .beta-text {
          font-size: clamp(28px, 10vw, 88px);
          letter-spacing: 6px;
        }
      }

      @media (max-width: 360px) {
        .captcha-text {
          font-size: 16px;
          letter-spacing: 1px;
        }

        .refresh-btn {
          width: 34px;
          height: 34px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Simple CAPTCHA</h1>
      <p id="instructions">
        Type the distorted characters to prove you are human.
      </p>

      <div class="captcha-box">
        <div id="captchaText" class="captcha-text"></div>
        <button class="refresh-btn" id="refreshCaptcha" title="New code">
          ⟳
        </button>
      </div>

      <div id="usbStage" class="usb-stage">
        <div class="usb-images">
          <img src="USB.png" alt="USB" class="usb-image" />
          <p class="usb-caption">
            вы вставляете USB в разъем, у вас две опции, вставить сразу, или
            сначала повернуть флэшку и снова вставить.
          </p>
        </div>
        <div class="usb-buttons">
          <button id="usbBtnAsIs" class="usb-btn">вставить флэшку</button>
          <button id="usbBtnRotate" class="usb-btn">
            перевернуть и вставить
          </button>
        </div>
      </div>

      <div class="field">
        <label for="captchaInput">Enter the text above</label>
        <input
          id="captchaInput"
          type="text"
          spellcheck="false"
          autocomplete="off"
        />
      </div>

      <button class="submit-btn" id="submitBtn">Verify</button>
      <div id="message" class="message"></div>
    </div>

    <!-- BETA-600 overlay (hidden until user passes all tests) -->
    <div id="betaOverlay" class="beta-overlay" aria-hidden="true">
      <div class="beta-text">BETA-600</div>
    </div>

    <script>
      const captchaTextEl = document.getElementById("captchaText");
      const captchaInputEl = document.getElementById("captchaInput");
      const messageEl = document.getElementById("message");
      const betaOverlayEl = document.getElementById("betaOverlay");
      const refreshBtn = document.getElementById("refreshCaptcha");
      const submitBtn = document.getElementById("submitBtn");
      const headerEl = document.querySelector("h1");
      const instructionsEl = document.getElementById("instructions");
      const captchaBoxEl = document.querySelector(".captcha-box");
      const fieldEl = document.querySelector(".field");
      const usbStageEl = document.getElementById("usbStage");
      const usbBtnAsIs = document.getElementById("usbBtnAsIs");
      const usbBtnRotate = document.getElementById("usbBtnRotate");

      let currentCaptcha = "";
      let successCount = 0;
      let usbMode = false;
      let usbAttempts = 0;

      const successMessages = [
        "Human detected. Initiating next ridiculous test...",
        "Still human. The robots are getting nervous...",
        "Impressive. You are at least 60% coffee.",
        "Nice. Unlocking bonus CAPTCHA, because why not?",
        "Okay, fine, you win this round, carbon-based lifeform.",
      ];

      const failureMessages = [
        "Nope. That looked kinda robot-ish. Try again.",
        "Close, but still suspicious. One more time.",
        "Wrong. Even my toaster could do better.",
        "Denied. Wiggle those organic fingers and retry.",
        "CAPTCHA says no. Your keyboard deserves a second chance.",
      ];

      const usbFailureMessages = [
        "Nope, upside down. Classic USB experience.",
        "Still not right. Try your patented wiggle technique.",
        "Mmm, almost. The port remains unimpressed.",
      ];

      function generateCaptcha() {
        // Fixed, non-random CAPTCHAs as requested
        const fixedCaptchas = [
          "я выучу иврит",
          "я люблю учить иврит",
          "שנה טובה",
        ];
        // Use successCount to determine which fixed captcha to show.
        // If user has passed more than the list length, keep showing the last one.
        const idx = Math.min(successCount, fixedCaptchas.length - 1);
        return fixedCaptchas[idx];
      }

      function startUsbStage() {
        usbMode = true;
        usbAttempts = 0;
        if (captchaBoxEl) captchaBoxEl.style.display = "none";
        if (fieldEl) fieldEl.style.display = "none";
        if (submitBtn) submitBtn.style.display = "none";
        if (refreshBtn) refreshBtn.style.display = "none";
        if (usbStageEl) usbStageEl.style.display = "block";
        messageEl.textContent = "";
        messageEl.className = "message";
        if (headerEl) headerEl.textContent = "USB Compatibility Test";
        if (instructionsEl)
          instructionsEl.textContent = "давай вставляй ее быстрее";
      }

      function renderCaptcha() {
        if (successCount >= 3 && !usbMode) {
          startUsbStage();
          return;
        }
        currentCaptcha = generateCaptcha();
        // Show the exact fixed phrase (no added spaces or random casing)
        captchaTextEl.textContent = currentCaptcha;
        captchaInputEl.value = "";
        messageEl.textContent = "";
        messageEl.className = "message";

        if (headerEl) {
          if (successCount === 0) {
            headerEl.textContent = "Simple CAPTCHA";
          } else if (successCount === 1) {
            headerEl.textContent = "Humanity Check: Level 2";
          } else if (successCount === 2) {
            headerEl.textContent = "Humanity Check: Level 3";
          } else if (successCount === 3) {
            headerEl.textContent = "Final Boss CAPTCHA";
          } else {
            headerEl.textContent = "Okay, you are VERY human.";
          }
        }

        if (instructionsEl) {
          if (successCount === 0) {
            instructionsEl.textContent =
              "Type the distorted characters to prove you are human.";
          } else if (successCount === 1) {
            instructionsEl.textContent =
              "Again, just to make the robots jealous.";
          } else if (successCount === 2) {
            instructionsEl.textContent =
              "At this point, it's more of a mini-game.";
          } else if (successCount === 3) {
            instructionsEl.textContent =
              "Beat this and we stop questioning your existence. Maybe.";
          } else {
            instructionsEl.textContent =
              "Extra round! Because humans love unnecessary challenges.";
          }
        }
      }

      function verifyCaptcha() {
        let value = captchaInputEl.value || "";
        // Normalize input: remove spaces and non-alphanumeric, compare case-insensitive
        const normalizedValue = value
          .replace(/\s+/g, "")
          .replace(/[^\p{L}\p{N}]/gu, "")
          .toLowerCase();
        const normalizedCaptcha = currentCaptcha
          .replace(/\s+/g, "")
          .replace(/[^\p{L}\p{N}]/gu, "")
          .toLowerCase();

        if (!normalizedValue) {
          messageEl.textContent = "Please enter the CAPTCHA.";
          messageEl.className = "message error";
          return false;
        }

        if (normalizedValue === normalizedCaptcha) {
          successCount++;
          const msg =
            successMessages[(successCount - 1) % successMessages.length];
          messageEl.textContent = msg;
          messageEl.className = "message ok";
          // After a short moment, give them a new, slightly sassier CAPTCHA
          setTimeout(renderCaptcha, 1200);
          return true;
        } else {
          const msg =
            failureMessages[Math.floor(Math.random() * failureMessages.length)];
          messageEl.textContent = msg;
          messageEl.className = "message error";
          renderCaptcha();
          return false;
        }
      }

      function handleUsbClick() {
        usbAttempts++;
        if (usbAttempts < 3) {
          const msg =
            usbFailureMessages[
              Math.floor(Math.random() * usbFailureMessages.length)
            ];
          messageEl.textContent = msg;
          messageEl.className = "message error";
        } else {
          messageEl.textContent = "USB flash drive inserted correctly!";
          messageEl.className = "message ok";
          usbBtnAsIs.disabled = true;
          usbBtnRotate.disabled = true;
          // Reveal the BETA-600 overlay when USB test completes
          showBeta600();
        }
      }

      function showBeta600() {
        if (!betaOverlayEl) return;
        betaOverlayEl.style.display = "flex";
        // allow CSS transition
        setTimeout(() => betaOverlayEl.classList.add("show"), 10);
        betaOverlayEl.setAttribute("aria-hidden", "false");
      }

      refreshBtn.addEventListener("click", function () {
        renderCaptcha();
      });

      submitBtn.addEventListener("click", function () {
        verifyCaptcha();
      });

      captchaInputEl.addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          verifyCaptcha();
        }
      });

      usbBtnAsIs.addEventListener("click", handleUsbClick);
      usbBtnRotate.addEventListener("click", handleUsbClick);

      renderCaptcha();
    </script>
  </body>
</html>
