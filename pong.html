<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –ü–æ–Ω–≥</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #0a0a2a;
        font-family: "Arial", sans-serif;
        touch-action: none;
      }

      canvas {
        display: block;
      }

      #ui {
        position: absolute;
        top: 20px;
        width: 100%;
        text-align: center;
        color: white;
        font-size: 24px;
        font-weight: bold;
        text-shadow: 0 0 10px #fff, 0 0 20px #ff0000;
        pointer-events: none;
        user-select: none;
      }

      #start-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        z-index: 10;
      }

      .btn {
        padding: 15px 30px;
        font-size: 20px;
        background: #c41e3a;
        color: white;
        border: 2px solid #fff;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 0 15px rgba(196, 30, 58, 0.6);
      }

      .btn:active {
        transform: scale(0.95);
      }
    </style>
  </head>
  <body>
    <div id="ui">
      <span id="playerScore">0</span> : <span id="aiScore">0</span>
    </div>

    <div id="start-screen">
      <h1>–° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! üéÑ</h1>
      <p>–£–ø—Ä–∞–≤–ª—è–π —Å–≤–æ–µ–π —Ä–∞–∫–µ—Ç–∫–æ–π (—Å–ª–µ–≤–∞), —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏—Ç—å –ò–ò!</p>
      <button class="btn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const playerScoreEl = document.getElementById("playerScore");
      const aiScoreEl = document.getElementById("aiScore");
      const startScreen = document.getElementById("start-screen");

      let gameRunning = false;
      let audioCtx = null;

      function playSound(frequency, duration) {
        if (!audioCtx) return;
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();

        oscillator.type = "square";
        oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);

        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(
          0.01,
          audioCtx.currentTime + duration
        );

        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        oscillator.start();
        oscillator.stop(audioCtx.currentTime + duration);
      }

      // Game constants
      const PADDLE_WIDTH = 15;
      const PADDLE_HEIGHT = 100;
      const BALL_SIZE = 12;
      const INITIAL_BALL_SPEED = 5;
      const SPEED_INCREMENT = 0.2;

      // Game state
      let player = { x: 20, y: 0, score: 0, color: "#c41e3a" }; // Red
      let ai = { x: 0, y: 0, score: 0, color: "#228b22" }; // Green
      let ball = { x: 0, y: 0, dx: 0, dy: 0, color: "#ffd700" }; // Gold
      let snowflakes = [];

      function init() {
        resize();
        player.y = canvas.height / 2 - PADDLE_HEIGHT / 2;
        ai.x = canvas.width - PADDLE_WIDTH - 20;
        ai.y = canvas.height / 2 - PADDLE_HEIGHT / 2;
        resetBall();
        createSnowflakes();
      }

      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ai.x = canvas.width - PADDLE_WIDTH - 20;
      }

      function createSnowflakes() {
        snowflakes = [];
        for (let i = 0; i < 50; i++) {
          snowflakes.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            radius: Math.random() * 3 + 1,
            speed: Math.random() * 1 + 0.5,
          });
        }
      }

      function resetBall() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        const angle = ((Math.random() - 0.5) * Math.PI) / 2; // Random angle between -45 and 45 deg
        const direction = Math.random() > 0.5 ? 1 : -1;
        ball.dx = direction * INITIAL_BALL_SPEED * Math.cos(angle);
        ball.dy = INITIAL_BALL_SPEED * Math.sin(angle);
      }

      function update() {
        if (!gameRunning) return;

        // Move ball
        ball.x += ball.dx;
        ball.y += ball.dy;

        // Wall collisions (top/bottom)
        if (ball.y <= 0 || ball.y + BALL_SIZE >= canvas.height) {
          ball.dy *= -1;
        }

        // AI Movement
        const aiCenter = ai.y + PADDLE_HEIGHT / 2;
        const aiSpeed = 4.5; // Slightly slower than ball to be beatable
        if (aiCenter < ball.y - 10) {
          ai.y += aiSpeed;
        } else if (aiCenter > ball.y + 10) {
          ai.y -= aiSpeed;
        }

        // Keep paddles in bounds
        player.y = Math.max(
          0,
          Math.min(canvas.height - PADDLE_HEIGHT, player.y)
        );
        ai.y = Math.max(0, Math.min(canvas.height - PADDLE_HEIGHT, ai.y));

        // Paddle collisions
        // Player
        if (
          ball.dx < 0 &&
          ball.x <= player.x + PADDLE_WIDTH &&
          ball.y + BALL_SIZE >= player.y &&
          ball.y <= player.y + PADDLE_HEIGHT
        ) {
          ball.dx *= -1.1; // Speed up
          ball.x = player.x + PADDLE_WIDTH;
          // Add some vertical influence based on where it hit the paddle
          const hitPos =
            (ball.y + BALL_SIZE / 2 - (player.y + PADDLE_HEIGHT / 2)) /
            (PADDLE_HEIGHT / 2);
          ball.dy += hitPos * 2;
        }

        // AI
        if (
          ball.dx > 0 &&
          ball.x + BALL_SIZE >= ai.x &&
          ball.y + BALL_SIZE >= ai.y &&
          ball.y <= ai.y + PADDLE_HEIGHT
        ) {
          ball.dx *= -1.1; // Speed up
          ball.x = ai.x - BALL_SIZE;
          const hitPos =
            (ball.y + BALL_SIZE / 2 - (ai.y + PADDLE_HEIGHT / 2)) /
            (PADDLE_HEIGHT / 2);
          ball.dy += hitPos * 2;
        }

        // Scoring
        if (ball.x < 0) {
          ai.score++;
          aiScoreEl.innerText = ai.score;
          resetBall();
        } else if (ball.x > canvas.width) {
          player.score++;
          playerScoreEl.innerText = player.score;
          resetBall();
        }

        // Update snowflakes
        snowflakes.forEach((s) => {
          s.y += s.speed;
          if (s.y > canvas.height) s.y = -10;
        });
      }

      function draw() {
        // Clear
        ctx.fillStyle = "#0a0a2a";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw snowflakes
        ctx.fillStyle = "white";
        snowflakes.forEach((s) => {
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
          ctx.fill();
        });

        // Draw center line
        ctx.setLineDash([10, 10]);
        ctx.strokeStyle = "rgba(255, 255, 255, 0.2)";
        ctx.beginPath();
        ctx.moveTo(canvas.width / 2, 0);
        ctx.lineTo(canvas.width / 2, canvas.height);
        ctx.stroke();
        ctx.setLineDash([]);

        // Draw paddles
        // Player (Candy Cane style)
        drawPaddle(player.x, player.y, player.color);
        // AI
        drawPaddle(ai.x, ai.y, ai.color);

        // Draw ball (Ornament)
        ctx.fillStyle = ball.color;
        ctx.beginPath();
        ctx.arc(
          ball.x + BALL_SIZE / 2,
          ball.y + BALL_SIZE / 2,
          BALL_SIZE / 2,
          0,
          Math.PI * 2
        );
        ctx.fill();
        // Shine on ball
        ctx.fillStyle = "rgba(255, 255, 255, 0.5)";
        ctx.beginPath();
        ctx.arc(
          ball.x + BALL_SIZE / 3,
          ball.y + BALL_SIZE / 3,
          BALL_SIZE / 5,
          0,
          Math.PI * 2
        );
        ctx.fill();
      }

      function drawPaddle(x, y, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, PADDLE_WIDTH, PADDLE_HEIGHT);

        // White stripes for festive look
        ctx.fillStyle = "white";
        for (let i = 0; i < PADDLE_HEIGHT; i += 20) {
          ctx.fillRect(x, y + i, PADDLE_WIDTH, 5);
        }
      }

      function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      function startGame() {
        startScreen.style.display = "none";
        gameRunning = true;
        player.score = 0;
        ai.score = 0;
        playerScoreEl.innerText = "0";
        aiScoreEl.innerText = "0";
        resetBall();
      }

      // Controls
      window.addEventListener("mousemove", (e) => {
        player.y = e.clientY - PADDLE_HEIGHT / 2;
      });

      window.addEventListener(
        "touchmove",
        (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          player.y = touch.clientY - PADDLE_HEIGHT / 2;
        },
        { passive: false }
      );

      window.addEventListener("resize", resize);

      init();
      gameLoop();
    </script>
  </body>
</html>
